<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="CY">





<title>fMRI | Serendipity</title>



    <link rel="icon" href="/bitbug_favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="/../fonts/iconfont2/iconfont.css">
    
    <link rel="stylesheet" href="/../fonts/iconfont3/iconfont.css">
    
    <link rel="stylesheet" href="/../fonts/iconfont4/iconfont.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    
    <script src="/js/jquery-3.6.0.min.js"></script>
    



    
    
        
    


<!-- æœç´¢çš„éƒ¨åˆ† -->



    <script>
    function searchToggle() {
        const width = $(document.body).width()
        if(width > 479) {
            return;
        }
        const search = $('.search');
		const searchForm = $('.form-search')
		const menuToggle = $('.menu-toggle');
		const title = $('.navbar-header-title ');

        if(!search.hasClass("mobile-search")) {
            search.addClass("mobile-search");
			menuToggle.addClass("open-search")
			title.addClass("mobile-title-hidden")
        } else {
            search.removeClass("mobile-search");
			menuToggle.removeClass("open-search")
			// title.css({visibility: 'visible'})
			title.removeClass("mobile-title-hidden")
        } 
    }

    function searchToggle() {
        const width = $(document.body).width()
        if(width > 479) {
            return;
        }
        const search = $('.search');
        const searchForm = $('.form-search');
        const menuToggle = $('.menu-toggle');
        const title = $('.navbar-header-title ');

        if(!search.hasClass("mobile-search")) {
            search.addClass("mobile-search");
            menuToggle.addClass("open-search")
            title.addClass("mobile-title-hidden")
        } else {
            search.removeClass("mobile-search");
            menuToggle.removeClass("open-search")
            // title.css({visibility: 'visible'})
            title.removeClass("mobile-title-hidden")
        } 
    }



    function search(searchInputEl, formEl, flag) {
        const path = "/" + "search.json"; // å¯ä»¥åœ¨public ä¸‹æŸ¥çœ‹è¿™ä¸ªsearch.json
        $(formEl).submit(function(e){
            e.preventDefault();
            let target = null
            if(searchInputEl == null) {
                const screenWidth = $(document.body).width();
                target = screenWidth > 479 ? $('#pc-search-input') : $('#mobile-search-input');
                console.log(target);
            } else {
                target = $(searchInputEl)
            }

            if(!flag && target.val() === '') {
                return ;
            }

            $("#u-search").fadeIn(500, function() {
                $("body > .wrapper").addClass("modal-active");

                $.ajax({
                    url: path,
                    dataType: "json",
                    beforeSend: function (xhr) {
                        $input = target.val();
                        $(".form-input").val($input);
                        const loadingBar = $('.search-loading-bar') 
                        loadingBar.css({
                            width:'100%',
                            display: 'block'
                        });
                    },
                    success: function( datas ) {
                        console.log(datas);
                        const $resultPanel = $(".modal-body")[0];
                        let str = `<ul class="modal-results">`;
                        var keywords = $(".form-input").val().trim().toLowerCase().split(/[\s\-]+/);
                        $resultPanel.innerHTML = "";
                        let hasResult = false
                        let text = `<div class="no-result">æ‰¾ä¸åˆ°ä¸å…³é”®è¯ç›¸å…³çš„å†…å®¹....</div>`;

                        if ($(".form-input").val().trim().length <= 0) {
                            // æ²¡æœ‰ç»“æœ
                            $resultPanel.innerHTML = text;
                            return;
                        }
                        datas.forEach(function (data, index) {
                            var isMatch = true;
                            if (!data.title || data.title.trim() === '') {
                                data.title = "Untitled";
                            }
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content && data.content.trim().replace(/<[^>]+>/g, "").toLowerCase() || '';
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty contents
                            if (data_content !== '') {
                                keywords.forEach(function (keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);

                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        hasResult = true
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            } else {
                                isMatch = false;
                            }
                            // show search results
                            if (isMatch) {
                                str += `<li class='result-item'><a href='${data_url}' class='result-item-detail'> <span class="title">${data_title}</span>`;
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 200 characters
                                    var start = first_occur - 40;
                                    var end = first_occur + 160;

                                    if (start < 0) {
                                        start = 0;
                                    }

                                    if (start == 0) {
                                        end = 200;
                                    }

                                    if (end > content.length) {
                                        end = content.length;
                                    }

                                    var match_content = content.substring(start, end);

                                    // highlight all keywords
                                    keywords.forEach(function (keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, `<em class="search-keyword">${keyword}</em>`);
                                    });

                                    str += `<span class="content"> ${match_content} ...</span></a>`;
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        if(hasResult) {
                            $resultPanel.innerHTML = str;
                        } else {
                            $resultPanel.innerHTML = text;
                        }

                    },
                    complete: function() {
                        setTimeout(() => {
                                const loadingBar = $('.search-loading-bar') 
                                loadingBar.css({
                                    width:'0%',
                                    display: 'none'
                                });
                        }, 300)
                    }
                });
            })

        });
    }

    $(document).ready(function() {
        $('.modal-close').click(function () { 
            $("#u-search").fadeOut();
            $("body > .wrapper").removeClass("modal-active")
        })

        $('.modal-overlay').click(function() {
            $("#u-search").fadeOut();
            $("body > .wrapper").removeClass("modal-active")
        })
        search(null, ".form-search", false)
        search("#u-search-modal-form .form-input", ".u-search-modal-form", true)
    })
</script>

<meta name="generator" content="Hexo 6.1.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <!-- div class="navbar-header header-logo"><a href="/">CY&#39;s Blog</a></div -->
			<div class="navbar-header header-logo"><a href="/"><i class="iconfont icon-zhuye" style="font-size: 1em;"></i>CY&#39;s Blog</a></div>
            <div class="menu navbar-right">
				<!-- è¿™é‡Œè¡¨ç¤ºçš„æ˜¯pcç«¯æœç´¢æ¡† -->
				
				
    <div class="search ">
        <div class="search-btn" onClick="searchToggle()">
            <img src="/image/search.png" class="search-btn-img" />
        </div>
        <form class="form-search">
            <input class="input" placeholder="ç‚¹æ­¤æœç´¢" autocomplete="off" id="pc-search-input"/>
        </form>
    </div>


                
                <a class="menu-item" href="/archives">ğŸ“šPosts</a>
                
                <a class="menu-item" href="/category">ğŸ“Categories</a>
                
                <a class="menu-item" href="/tag">ğŸ·ï¸Tags</a>
                
                <a class="menu-item" href="/about">ğŸ“‘About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">CY&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
				<div class="navbar-mobile-right">
					
					
    <div class="search ">
        <div class="search-btn" onClick="searchToggle()">
            <img src="/image/search.png" class="search-btn-img" />
        </div>
        <form class="form-search">
            <input class="input" placeholder="ç‚¹æ­¤æœç´¢" autocomplete="off" id="mobile-search-input"/>
        </form>
    </div>


					<div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
				</div>
				
            </div>
            <div class="menu" id="mobile-menu">
                
                <a class="menu-item" href="/archives">ğŸ“šPosts</a>
                
                <a class="menu-item" href="/category">ğŸ“Categories</a>
                
                <a class="menu-item" href="/tag">ğŸ·ï¸Tags</a>
                
                <a class="menu-item" href="/about">ğŸ“‘About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">fMRI</h1>
            
                <div class="post-meta">
                    
                        ğŸ‘¨â€ğŸ“Author: <a itemprop="author" rel="author" href="/">CY</a>
                    

                    
                        <span class="post-time">
                        ğŸ“…Date: <a href="#">March 21, 2024&nbsp;&nbsp;22:24:27</a>
                        </span>
                    
                    
                        <span class="post-category">
							ğŸ“šCategory:
                            
                                <a href="/categories/data/">data</a>
                            
                        </span>
                    
					
					
						<span class="post-count">
					ğŸ“‘Words:
						<a href="">4.1k</a>
						</span>
					
					
						<span class="post-count">
					â±ï¸Time:
						<a href="">15min</a>  
						</span>
					
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="1-fmriç›¸å…³çŸ¥è¯†"><a class="markdownIt-Anchor" href="#1-fmriç›¸å…³çŸ¥è¯†"></a> 1. fMRIç›¸å…³çŸ¥è¯†</h1>
<h2 id="11-dicomç®€ä»‹"><a class="markdownIt-Anchor" href="#11-dicomç®€ä»‹"></a> 1.1 DICOMç®€ä»‹</h2>
<p>â€‹	 <code>DICOM</code> ï¼ˆDigital Imaging and Communications in Medicineï¼‰ å³åŒ»å­¦æ•°å­—æˆåƒå’Œé€šä¿¡ï¼Œæ˜¯åŒ»å­¦å›¾åƒå’Œç›¸å…³ä¿¡æ¯çš„å›½é™…æ ‡å‡†ï¼ˆISO 12052ï¼‰ã€‚ <code>DICOM</code> è¢«å¹¿æ³›åº”ç”¨äºæ”¾å°„åŒ»ç–—ï¼Œå¿ƒè¡€ç®¡æˆåƒä»¥åŠæ”¾å°„è¯Šç–—è¯Šæ–­è®¾å¤‡ï¼ˆXå°„çº¿ï¼ŒCTï¼Œæ ¸ç£å…±æŒ¯ï¼Œè¶…å£°ç­‰ï¼‰ï¼Œå¹¶ä¸”åœ¨çœ¼ç§‘å’Œç‰™ç§‘ç­‰å…¶å®ƒåŒ»å­¦é¢†åŸŸå¾—åˆ°è¶Šæ¥è¶Šæ·±å…¥å¹¿æ³›çš„åº”ç”¨ã€‚ç›®å‰é‡‡ç”¨çš„æ ‡å‡†æ˜¯ <code>DICOM3.0</code> ï¼Œæ¯ä¸€å¼ å›¾åƒä¸­éƒ½æºå¸¦ç€å¤§é‡çš„ä¿¡æ¯ã€‚</p>
<h2 id="12-nlfti"><a class="markdownIt-Anchor" href="#12-nlfti"></a> 1.2 NlfTI</h2>
<p>â€‹	åŒ»å­¦æˆåƒæ•°æ®çš„æ–‡ä»¶æ ¼å¼ï¼Œå¦‚ <code>DICOM</code> å’Œ <code>NIfTI</code> ï¼Œè™½ç„¶ç±»ä¼¼ä½†å…·æœ‰ä¸åŒçš„åŠŸèƒ½ã€‚ <code>NIfTI</code> ä¸»è¦ç”¨äºåŒ»å­¦æˆåƒå’Œç¥ç»ç§‘å­¦ç ”ç©¶é¢†åŸŸï¼Œè€Œ <code>DICOM</code> æ˜¯å­˜å‚¨å’Œåˆ†å‘åŒ»å­¦å›¾ç‰‡çš„æ ‡å‡†æ–‡ä»¶æ ¼å¼ã€‚<code>NIfTI</code> æ ¼å¼æ˜¯ä¸ºäº†æ”¹è¿›ä»¥å‰ç”¨äºå­˜å‚¨åŒ»å­¦æˆåƒæ•°æ®çš„æ ‡å‡† <code>Analyze</code> æ ¼å¼çš„ç¼ºç‚¹è€Œåˆ›å»ºçš„ã€‚ é™¤äº†å®é™…çš„å›¾ç‰‡æ•°æ®ï¼Œ<code>NIfTI</code> æ–‡ä»¶è¿˜åŒ…æ‹¬å…ƒæ•°æ®ï¼Œå¦‚å›¾åƒçš„æµ‹é‡ã€åƒç´ å¤§å°å’Œæ–¹å‘ï¼Œä»¥åŠå¯èƒ½åœ¨åŸå§‹æ•°æ®ä¸Šæ‰§è¡Œçš„ä»»ä½•é¢„å¤„ç†çš„ç»“æœã€‚</p>
<p>â€‹	 <code>DICOM</code> æ–‡ä»¶é€šå¸¸ä»¥ä¸€ç³»åˆ—æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œæ¯ä¸ªæ–‡ä»¶ä»£è¡¨ä¸€å±‚æ‰«æã€‚è¿™æ„å‘³ç€ä¸€ä¸ªå®Œæ•´çš„3Dæ‰«æå¯èƒ½ç”±æ•°ç™¾ä¸ªå•ç‹¬çš„æ–‡ä»¶ç»„æˆã€‚å°†å®ƒä»¬è½¬æ¢ä¸ºå•ä¸€çš„ <code>NIfTI</code> æ–‡ä»¶å¯ä»¥ç®€åŒ–æ–‡ä»¶ç®¡ç†ï¼Œä½¿å¾—åŠ è½½å’Œå¤„ç†æ•°æ®æ›´åŠ é«˜æ•ˆã€‚æœ‰è®¸å¤šåªèƒ½å¤„ç† <code>NIfTI</code> æ–‡ä»¶çš„åŒ»å­¦æˆåƒè½¯ä»¶ç¨‹åºå’Œåˆ†æå·¥å…·ï¼Œå› æ­¤è½¬æ¢ <code>DICOM</code> æ–‡ä»¶æ˜¯ä¸€é¡¹å¸¸è§„ä»»åŠ¡ã€‚ä½¿ç”¨.nii.gzæ ¼å¼å¯ä»¥æœ‰æ•ˆå‡å°æ–‡ä»¶å¤§å°ï¼Œä¾¿äºå­˜å‚¨å’Œä¼ è¾“ï¼ŒåŒæ—¶ä¿æŒæ•°æ®çš„å®Œæ•´æ€§å’Œå¯ç”¨æ€§ã€‚å¯ä»¥ä½¿ç”¨å¤šç§å·¥å…·å’Œè½¯ä»¶åŒ…å°† <code>DICOM</code> è½¬æ¢ä¸º <code>NIfTI</code> ã€‚</p>
<ul>
<li>
<p><strong>dcm2niix</strong> - An improved variant of dcm2nii, dcm2niix can process more intricate DICOM data and produce <a target="_blank" rel="noopener" href="https://www.tasq.ai/glossary/json/">JSON</a> sidecar files.</p>
<p>å®‰è£…ï¼š <code>conda install -c conda-forge dcm2niix</code></p>
<p>å¸¸ç”¨å‘½ä»¤ï¼š <code>dcm2niix -z y -f %i_%d_%s -o outdir dcmdir</code></p>
<figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-f è¾“å‡ºæ–‡ä»¶å (default: -f %f%p%t%s)</span><br><span class="line">%iï¼šæ’å…¥ç—…äººIDï¼ˆDICOMæ ‡ç­¾0010,0020ï¼‰ã€‚ä¾‹å¦‚ï¼Œâ€œmyNameï¼…iâ€çš„è¾“å‡ºæ–‡ä»¶åå°†æŠŠç—…äººIDå‘½åä¸ºâ€œID123â€çš„å›¾åƒè½¬æ¢ä¸ºâ€œmyNameID123.niiâ€</span><br><span class="line">%dï¼šæ’å…¥ç³»åˆ—æè¿°ï¼ˆ0008,103Eï¼‰ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨â€œmyNameï¼…dâ€è½¬æ¢çš„å›æ³¢å¹³é¢å›¾åƒä¼šäº§ç”Ÿâ€œmyNameEPIâ€</span><br><span class="line">%sï¼šæ’å…¥ç³»åˆ—ï¼ˆDICOMæ ‡ç­¾0020,0011ï¼‰ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨è¾“å‡ºæ–‡ä»¶åâ€œmyNameï¼…sâ€å°†ç¬¬äºŒä¸ªåºåˆ—è½¬æ¢ä¸ºâ€œmyName2.niiâ€ã€‚</span><br><span class="line">%zï¼šæ’å…¥åºåˆ—åç§°ï¼ˆ0018,0024ï¼‰ï¼Œå› æ­¤ä½¿ç”¨â€œmyNameï¼…zâ€è½¬æ¢çš„T1æ‰«æå¯èƒ½ä¼šäº§ç”Ÿâ€œmyNameT1â€ã€‚</span><br><span class="line"></span><br><span class="line">-o: è¾“å‡ºæ–‡ä»¶å¤¹</span><br><span class="line">-z: æ˜¯å¦å‹ç¼©</span><br></pre></td></tr></tbody></table></figure>
</li>
<li>
<p><strong>pydicom</strong> - Pythonâ€™s pydicom package may be used to read and write DICOM files and convert them to NIfTI.</p>
</li>
<li>
<p><strong>SPM</strong>â€“ Statistical Parametric Mapping is a program that may be used to analyze images</p>
</li>
<li>
<p><strong>ITK-Snap</strong> - is an image analysis toolkit that may be used to segment images</p>
</li>
</ul>
<p>åƒ <code>SPM</code> å’Œ <code>ITK-Snap</code> è¿™æ ·çš„ä¸€äº›å·¥å…·æ›´å¤æ‚ï¼Œéœ€è¦åŸ¹è®­æ‰èƒ½æ“ä½œï¼Œè€Œåƒ <code>dcm2nii</code> å’Œ <code>dcm2niix</code> è¿™æ ·çš„å·¥å…·æ˜¯åŸºäºå‘½ä»¤è¡Œçš„ï¼Œæ“ä½œç®€å•ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºä¸­çš„å¤§å¤šæ•°éƒ½å¸Œæœ›å›¾ç‰‡åœ¨è½¬æ¢ä¹‹å‰å¤„äºç‰¹å®šçš„æ ¼å¼å’Œç»„ç»‡ç»“æ„ï¼Œæ¯”å¦‚ç‰¹å®šçš„æ–‡ä»¶å¤¹ç»“æ„ã€‚</p>
<blockquote>
<p>è®¸å¤šæˆåƒç¨‹åºç°åœ¨èƒ½å¤Ÿè¯»å–å’Œå†™å…¥NIfTIæ–‡ä»¶ï¼Œå› ä¸ºè¿™ç§æ ¼å¼åœ¨è¯¥é¢†åŸŸå·²è¢«å¹¿æ³›æ¥å—ã€‚ç”±äºå¾—åˆ°è®¸å¤šè®¡ç®—æœºè¯­è¨€å’Œåº“çš„æ”¯æŒï¼ŒNIfTIæ•°æ®å¯ä»¥åœ¨å„ç§ç¨‹åºä¸­è½»æ¾æ“ä½œã€‚ä¾‹å¦‚ï¼ŒITK-Snapã€FSLã€SPMå’ŒAFNIéƒ½èƒ½è¯»å–NIfTIæ–‡ä»¶ï¼ˆä»¥.niiæˆ–.nii.gzç»“å°¾ï¼‰ã€‚</p>
</blockquote>
<h3 id="121-nifti-file-format"><a class="markdownIt-Anchor" href="#121-nifti-file-format"></a> 1.2.1 NIfTI file format</h3>
<ul>
<li><strong>the actual image data</strong></li>
<li><strong>header information</strong></li>
</ul>
<p>æ–‡ä»¶åŒ…å«å¤´æ–‡ä»¶ï¼ˆtext dataï¼‰å’Œå›¾ç‰‡æ•°æ®ï¼ˆbinary dataï¼‰ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nibabel <span class="keyword">as</span> nib</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–NIfTIæ–‡ä»¶</span></span><br><span class="line">nii_path = <span class="string">'/root/workspace/project/fmri_pre/data/009_MB1200_32C_shiyan1_niix/009_MB1200_32C_shiyan1Lulin-zhangyuxin-day_HB_202403131406249.nii.gz'</span></span><br><span class="line">nii_img = nib.load(nii_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ•°æ®æ•°ç»„</span></span><br><span class="line">data = nii_img.get_fdata()</span><br><span class="line"><span class="built_in">print</span>(data.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹niftiæ–‡ä»¶çš„ä»¿å°„çŸ©é˜µï¼Œå¾—åˆ°åæ ‡åŸç‚¹å’Œä½“ç´ å¤§å°</span></span><br><span class="line">affine = nii_img.affine</span><br><span class="line"><span class="comment"># æå–ä½“ç´ å¤§å°</span></span><br><span class="line">voxel_sizes = (affine[<span class="number">0</span>, <span class="number">0</span>], affine[<span class="number">1</span>, <span class="number">1</span>], affine[<span class="number">2</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–åæ ‡åŸç‚¹ï¼ˆä¸–ç•Œåæ ‡ç³»ä¸­ï¼‰</span></span><br><span class="line">origin = affine[:<span class="number">3</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"ä½“ç´ å¤§å°(mm):"</span>, voxel_sizes)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"åæ ‡åŸç‚¹(ä¸–ç•Œåæ ‡):"</span>, origin)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–NIfTIå¤´æ–‡ä»¶</span></span><br><span class="line">header = nii_img.header</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°å¤´æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line"><span class="built_in">print</span>(header)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="13-fmriæŠ€æœ¯åŸç†"><a class="markdownIt-Anchor" href="#13-fmriæŠ€æœ¯åŸç†"></a> 1.3 fMRIæŠ€æœ¯åŸç†</h2>
<p>â€‹	åœ¨å¤–ç•Œè§†è§‰åˆºæ¿€ä¸‹ï¼Œè§†è§‰çš®å±‚ä¸­ç¥ç»ç»†èƒæ¿€æ´»ï¼Œè¡€ç®¡è€—æ°§é‡å¢åŠ ï¼Œè„‘è¡€æµé€Ÿç‡å¢é•¿ï¼Œç”±äºè„‘å¢é•¿çš„é€Ÿç‡è¿œå¤§äºè„‘æ°§ä»£è°¢ç‡ï¼Œå¯¼è‡´ç¥ç»æ¿€æ´»å¤„æ°§å«é‡çš„ä¾›åº”è¿œå¤§äºæ¶ˆè€—ï¼Œä½¿å¾—è„±æ°§è¡€çº¢è›‹ç™½æ¯”ä¾‹é™ä½ã€‚ç”±äºè¡€çº¢è›‹ç™½æ˜¯å¦å«æ°§åœ¨ç£æ€§ä¸Šç¨æœ‰å·®åˆ«ï¼Œå«è¡€çº¢è›‹ç™½æ˜¯æŠ—ç£æ€§çš„ï¼Œè€Œè„±è¡€çº¢è›‹ç™½æ˜¯é¡ºç£æ€§çš„ï¼Œåœ¨ç£åœºä¸­ä¼šå¼•èµ·è‡ªæ—‹æ•£ç›¸ï¼Œå¯¼è‡´ç£å…±æŒ¯ä¿¡å·åœ¨å«æ°§çš„è¡€æ¶²ä¸­æ˜¾ç¤ºé«˜ä¿¡å·ï¼Œè€Œåœ¨è„±æ°§çš„è¡€æ¶²ä¸­æ˜¾ç¤ºä½ä¿¡å·ã€‚ç¥ç»æ´»åŠ¨å¼•èµ·çš„å«æ°§è¡€çº¢è›‹ç™½æ¯”ä¾‹å‡é«˜ï¼Œä½¿å¾—è¿™ç§è¡€æ°§æ°´å¹³ä¾èµ–(Blood Oxygenation Level Dependent,BOLD) ä¿¡å·å¢åŠ ã€‚å› æ­¤ï¼Œ <code>BOLD</code> ä¿¡å·çš„æ”¹å˜ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åæ˜ è§†è§‰çš®å±‚åŒºåŸŸç¥ç»æ´»åŠ¨çš„æƒ…å†µï¼ŒMRIæ˜¯ç›®å‰äº†è§£å¤§è„‘åŠŸèƒ½æœ€å¥½çš„å·¥å…·ä¹‹ä¸€ã€‚ç›¸æ¯”ç¥ç»æ´»åŠ¨ï¼Œè¡€æµå¢åŠ å¤§çº¦å­˜åœ¨5è‡³8ç§’çš„æ»åï¼Œå› æ­¤ï¼Œ <code>MRI</code> çš„æ—¶é—´åˆ†è¾¨ç‡ä¸é«˜ï¼Œå¯¼è‡´fMRIå®éªŒæ•°æ®çš„é‡‡é›†éœ€è¦è€—è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œåˆ¶çº¦äº† <code>fMRI</code> è§†è§‰ä¿¡æ¯è§£æç ”ç©¶çš„æ•°æ®è§„æ¨¡ã€‚</p>
<p>â€‹	fMRIé‡‡é›†å¤§è„‘çš„BOLDä¿¡å·ï¼Œé€šè¿‡ä¸‰ç»´é‡æ„ç­‰é¢„å¤„ç†è¿‡ç¨‹ï¼Œå¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—ä¸‰ç»´å¤§è„‘å›¾åƒï¼Œæ¯ä¸ªä¸‰ç»´å›¾åƒéƒ½åŒ…å«å¤§é‡ä½“ç´ ã€‚ä½“ç´ æ˜¯ä¸‰ç»´ç©ºé—´ä¸­æˆåƒçš„åŸºæœ¬å•å…ƒï¼Œä¸äºŒç»´å›¾åƒä¸­çš„åƒç´ å¯¹åº”ï¼Œæ¯ä¸ªä½“ç´ çš„æ—¶é—´ä¿¡å·å°±æ˜¯è¯¥ä½“ç´ å¯¹åº”è§†è§‰çš®å±‚ç©ºé—´åŒºåŸŸå†…ç¥ç»å…ƒç¾¤ä½“æ´»åŠ¨å¼•èµ·çš„BOLDä¿¡å·ã€‚å½“è¢«è¯•è§‚çœ‹å›¾åƒåˆºæ¿€æ—¶ï¼Œç›¸åº”çš„è§†è§‰çš®å±‚MRIä½“ç´ ä¼šéšæ—¶é—´å‘ç”Ÿè§„å¾‹æ€§çš„å˜åŒ–ã€‚ä¸€ä¸ªä½“ç´ å¤§çº¦åŒ…å«10ä¸ªç¥ç»ç»†èƒï¼Œä½“ç´ çš„BOLDä¿¡å·æ˜¯å¤§é‡ç¥ç»ç»†èƒçš„è¡€æ¶²åŠ¨åŠ›å­¦å“åº”çš„ç»¼åˆç»“æœï¼Œåæ˜ äº†è¯¥åŒºåŸŸå†…å¤§é‡ç¥ç»æ´»åŠ¨çš„ç»¼åˆæƒ…å†µã€‚[^1]</p>
<h2 id="14-å›¾åƒåˆºæ¿€ä¸‹çš„ä¸€èˆ¬èŒƒå¼"><a class="markdownIt-Anchor" href="#14-å›¾åƒåˆºæ¿€ä¸‹çš„ä¸€èˆ¬èŒƒå¼"></a> 1.4 å›¾åƒåˆºæ¿€ä¸‹çš„ä¸€èˆ¬èŒƒå¼</h2>
<p>â€‹	ä½œä¸ºè§†è§‰åˆºæ¿€çš„å›¾åƒæ•°æ®é›†é€šå¸¸ä»å…¬å¼€è‡ªç„¶å›¾åƒæ•°æ®åº“ä¸­é€‰æ‹©ï¼Œä¸ºäº†åç»­è®¡ç®—æ¨¡å‹çš„è®­ç»ƒå’ŒéªŒè¯ï¼Œé€šå¸¸æŠŠæ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚ç„¶åï¼Œé€šå¸¸æŒ‰ç…§éšæœºé€‰æ‹©çš„é¡ºåºï¼Œä½¿ç”¨åˆºæ¿€å‘ˆç°è½¯ä»¶å¦‚ <code>E-Prime</code>  ç­‰ï¼Œæ ¹æ®é¢„å…ˆè®¾å®šçš„å‘ˆç°æ—¶é—´ã€å‘ˆç°é¢‘ç‡ã€ä¼‘æ¯é—´éš™ç­‰æ’­æ”¾ç»™è¢«è¯•è§‚çœ‹ã€‚é€šå¸¸ä¸€æ¬¡å›¾åƒå‘ˆç°å’Œæ•°æ®é‡‡é›†è¢«ç§°ä½œä¸€æ¬¡è¯•éªŒ(trial)ï¼Œå¦‚æ ¼å…°ç‰¹å›¢é˜Ÿä½¿ç”¨ 200æ¯«ç§’çš„é¢‘ç‡å’Œç°è‰²èƒŒæ™¯äº¤æ›¿å‘ˆç°ï¼ŒæŒç»­ 1 ç§’ï¼Œç„¶åå‘ˆç° 3 ç§’çš„ç°è‰²èƒŒæ™¯ï¼Œæ€»å…± 4 ç§’æ—¶é—´ï¼Œæ¥ç€è¿›è¡Œä¸‹ä¸€å¹…å›¾åƒåˆºæ¿€çš„å‘ˆç°è¯•éªŒã€‚è‹¥å¹²å›¾åƒåˆºæ¿€çš„ä¸æ–­å‘ˆç°é€šå¸¸ä½œä¸ºä¸€æ¬¡æ‰«æ(run)ï¼Œå¤šæ¬¡æ‰«æç»„æˆä¸€æ¬¡å®éªŒï¼Œé€šå¸¸ï¼Œæ•´ä¸ªæ•°æ®åº“å›¾åƒçš„å‘ˆç°åˆåˆ†æˆè‹¥å¹²æ¬¡å®éªŒã€‚å¦å¤–ï¼Œä½œä¸ºæµ‹è¯•é›†çš„å›¾åƒé€šå¸¸è¢«é‡å¤å¤šæ¬¡å‘ˆç°ï¼Œç”¨äºæé«˜ BOLD ä¿¡å·çš„ä¿¡å™ªæ¯”ã€‚</p>
<h1 id="2-æ•°æ®é¢„å¤„ç†"><a class="markdownIt-Anchor" href="#2-æ•°æ®é¢„å¤„ç†"></a> 2. æ•°æ®é¢„å¤„ç†</h1>
<p>â€‹	åœ¨å°†æ•°æ®è¾“å…¥åˆ°æ¨¡å‹ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—é¢„å¤„ç†æ­¥éª¤ï¼Œä»¥æé«˜æ•°æ®è´¨é‡å¹¶å‡å°‘å™ªå£°çš„å½±å“ã€‚å¯¹äºfMRIæ•°æ®ï¼Œå¸¸è§çš„é¢„å¤„ç†æ­¥éª¤åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p><strong>Fuse and Conform</strong> : fMRIå®éªŒä¸­é€šå¸¸éœ€è¦å¤šæ¬¡æ‰«æï¼ŒåŒ…æ‹¬åŠŸèƒ½æ‰«æå’Œç»“æ„æ‰«æï¼Œæœ‰æ—¶è¿˜åŒ…æ‹¬ä¸åŒçš„æ¡ä»¶å’Œé‡å¤å®éªŒã€‚ä¸åŒçš„æ‰«æå¯èƒ½æœ‰ä¸åŒçš„åˆ†è¾¨ç‡å’Œæ–¹å‘ã€‚ä¸ºäº†èƒ½å¤Ÿå°†è¿™äº›ä¸åŒçš„æ•°æ®é›†å‡†ç¡®åœ°å åŠ åœ¨ä¸€èµ·ï¼Œéœ€è¦å…ˆå°†å®ƒä»¬è½¬æ¢æˆç»Ÿä¸€çš„æ ‡å‡†ã€‚è¿™ä¸€æ­¥ä¹Ÿæ˜¯ä½¿æ•°æ®å‡†å¤‡è¿›ä¸€æ­¥åˆ†æï¼ˆå¦‚è„‘åŒºåˆ†å‰²ã€åŠŸèƒ½å®šä½ç­‰ï¼‰çš„åŸºç¡€ã€‚</p>
</li>
<li>
<p><strong>Skull-stripping</strong> : å»é™¤å¤´å£³</p>
</li>
<li>
<p><strong>Spatial Normalization</strong>ï¼šå¦‚æœå°šæœªå®Œæˆï¼Œå°†æ‰€æœ‰è¢«è¯•çš„è„‘å›¾åƒå˜æ¢åˆ°æ ‡å‡†ç©ºé—´ï¼ˆå¦‚ <code>MNI</code> ç©ºé—´ï¼‰ã€‚</p>
<blockquote>
<p>æ ‡å‡†ç©ºé—´ï¼Œå¦‚è’™ç‰¹åˆ©å°”ç¥ç»å­¦ç ”ç©¶æ‰€ï¼ˆMontreal Neurological Institute, MNIï¼‰ç©ºé—´ï¼Œæ˜¯ç¥ç»å½±åƒå­¦ä¸­ç”¨äºæ•°æ®åˆ†æå’Œæ¯”è¾ƒçš„ä¸€ç§å…±åŒå‚è€ƒæ¡†æ¶ã€‚åœ¨ç¥ç»ç§‘å­¦ç ”ç©¶ä¸­ï¼Œç ”ç©¶è€…ç»å¸¸éœ€è¦æ¯”è¾ƒæ¥è‡ªä¸åŒä¸ªä½“çš„å¤§è„‘ç»“æ„æˆ–åŠŸèƒ½å›¾åƒã€‚ç„¶è€Œï¼Œç”±äºæ¯ä¸ªäººçš„å¤§è„‘å¤§å°ã€å½¢çŠ¶å’Œå®šä½éƒ½æœ‰æ‰€ä¸åŒï¼Œç›´æ¥æ¯”è¾ƒè¿™äº›å›¾åƒä¼šéå¸¸å›°éš¾ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç§‘å­¦å®¶ä»¬å¼€å‘äº†æ ‡å‡†ç©ºé—´ï¼Œå³å°†ä¸ªä½“çš„å¤§è„‘å›¾åƒå˜æ¢åˆ°ä¸€ä¸ªå…±åŒçš„å‚è€ƒæ¡†æ¶å†…ï¼Œä»¥ä¾¿è¿›è¡Œæœ‰æ•ˆçš„æ¯”è¾ƒå’Œåˆ†æã€‚</p>
<p>MNIç©ºé—´æ˜¯æœ€å¹¿æ³›ä½¿ç”¨çš„æ ‡å‡†ç©ºé—´ä¹‹ä¸€ï¼Œç”±è’™ç‰¹åˆ©å°”ç¥ç»å­¦ç ”ç©¶æ‰€åˆ›å»ºã€‚å®ƒåŸºäºå¤šä¸ªå¥åº·æˆå¹´äººå¤§è„‘çš„å¹³å‡å½¢çŠ¶å’Œå¤§å°ï¼Œæä¾›äº†ä¸€ä¸ªæ ‡å‡†åŒ–çš„3Då‚è€ƒæ¡†æ¶ã€‚MNIç©ºé—´å…è®¸ç ”ç©¶è€…å°†æ¥è‡ªä¸åŒä¸ªä½“çš„å¤§è„‘æˆåƒæ•°æ®å¯¹é½åˆ°ç›¸åŒçš„ä¸‰ç»´åæ ‡ç³»ç»Ÿä¸­ï¼Œä»è€Œä½¿æ¯”è¾ƒå’Œç¾¤ä½“åˆ†ææˆä¸ºå¯èƒ½ã€‚</p>
<p>å°†ä¸ªä½“å¤§è„‘æ•°æ®å˜æ¢åˆ°æ ‡å‡†ç©ºé—´çš„è¿‡ç¨‹é€šå¸¸æ¶‰åŠå‡ ä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>é…å‡†ï¼ˆRegistrationï¼‰</strong>ï¼šä½¿ç”¨çº¿æ€§ï¼ˆåˆšä½“æˆ–ä»¿å°„ï¼‰å’Œéçº¿æ€§å˜æ¢å°†ä¸ªä½“å¤§è„‘å›¾åƒå¯¹é½åˆ°æ ‡å‡†ç©ºé—´æ¨¡æ¿ã€‚</li>
<li><strong>å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰</strong>ï¼šè°ƒæ•´å›¾åƒçš„å°ºåº¦ï¼Œä»¥åŒ¹é…æ ‡å‡†ç©ºé—´çš„å¤§å°å’Œå½¢çŠ¶ã€‚</li>
<li><strong>é‡é‡‡æ ·ï¼ˆResamplingï¼‰</strong>ï¼šåœ¨å˜æ¢åˆ°æ ‡å‡†ç©ºé—´åï¼Œæ ¹æ®æ ‡å‡†ç©ºé—´çš„åˆ†è¾¨ç‡è°ƒæ•´å›¾åƒçš„ä½“ç´ å¤§å°ã€‚</li>
</ol>
</blockquote>
</li>
<li>
<p><strong>Brain Tissue Segmentation</strong> : å°†è„‘æˆåƒæ•°æ®ä¸­çš„ä¸åŒç»„ç»‡ç±»å‹ï¼ˆå¦‚ç°è´¨ã€ç™½è´¨å’Œè„‘è„Šæ¶²ï¼‰åŒºåˆ†å¼€çš„è¿‡ç¨‹ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡åˆ†æMRIå›¾åƒçš„å¼ºåº¦å€¼æ¥å®ç°çš„ï¼Œå› ä¸ºä¸åŒçš„è„‘ç»„ç»‡ç±»å‹åœ¨MRIæ‰«æä¸­å‘ˆç°ä¸åŒçš„ä¿¡å·å¼ºåº¦ã€‚</p>
</li>
</ul>
<h1 id="3-è·å–ç‰¹å®šè„‘åŒºæ•°æ®"><a class="markdownIt-Anchor" href="#3-è·å–ç‰¹å®šè„‘åŒºæ•°æ®"></a> 3. è·å–ç‰¹å®šè„‘åŒºæ•°æ®</h1>
<h3 id="1-ä½¿ç”¨æ ‡å‡†è„‘å›¾è°±è·å–æ©ç "><a class="markdownIt-Anchor" href="#1-ä½¿ç”¨æ ‡å‡†è„‘å›¾è°±è·å–æ©ç "></a> 1. ä½¿ç”¨æ ‡å‡†è„‘å›¾è°±è·å–æ©ç </h3>
<p>â€‹	è®¸å¤šå…¬å¼€çš„è„‘å›¾è°±å·²ç»æ ‡æ³¨äº†ä¸åŒçš„è„‘åŒºï¼ŒåŒ…æ‹¬è§†è§‰åŒºåŸŸã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>Automated Anatomical Labeling (AAL) å›¾è°±</strong>ï¼šæä¾›äº†å¤§è„‘å„ä¸ªåŒºåŸŸçš„æ ‡æ³¨ï¼ŒåŒ…æ‹¬è§†è§‰çš®å±‚åŒºåŸŸã€‚</li>
<li><strong>Harvard-Oxford Atlas</strong>ï¼šåŒæ ·æä¾›äº†è¯¦ç»†çš„è„‘åŒºåˆ’åˆ†ã€‚</li>
<li><strong>Brodmann Areas</strong>ï¼šæ ¹æ®çš®å±‚ç»†èƒç»“æ„çš„ä¸åŒï¼Œåˆ’åˆ†äº†å¤§è„‘çš„å¤šä¸ªåŒºåŸŸï¼Œå…¶ä¸­åŒ…æ‹¬è§†è§‰å¤„ç†åŒºåŸŸã€‚</li>
</ul>
<p>ä½¿ç”¨è¿™äº›å›¾è°±ï¼Œä½ å¯ä»¥ç›´æ¥è·å–åˆ°é¢„å®šä¹‰çš„è§†è§‰åŒºåŸŸæ©ç ã€‚</p>
<h3 id="2-ä½¿ç”¨ç¥ç»å½±åƒè½¯ä»¶è·å–æ©ç "><a class="markdownIt-Anchor" href="#2-ä½¿ç”¨ç¥ç»å½±åƒè½¯ä»¶è·å–æ©ç "></a> 2. ä½¿ç”¨ç¥ç»å½±åƒè½¯ä»¶è·å–æ©ç </h3>
<p>â€‹	è½¯ä»¶å¦‚ <code>FSL</code> ã€<code>SPM</code> ã€æˆ– <code>FreeSurfer</code> ç­‰ï¼Œéƒ½å¯ä»¥åˆ©ç”¨ä¸Šè¿°å›¾è°±æ¥ç”Ÿæˆç‰¹å®šè„‘åŒºçš„æ©ç ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>FSL</code> çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ‰“å¼€FSLeyesã€‚</li>
<li>åŠ è½½ä½ çš„<strong>æ ‡å‡†è„‘</strong>ï¼ˆä¾‹å¦‚ï¼ŒMNI152æ ‡å‡†è„‘ï¼‰ã€‚</li>
<li>æ‰¾åˆ°å¯¹åº”çš„å›¾è°±å¹¶åº”ç”¨åˆ°æ ‡å‡†è„‘ä¸Šã€‚</li>
<li>é€‰æ‹©ä½ æ„Ÿå…´è¶£çš„è§†è§‰åŒºåŸŸã€‚</li>
<li>å¯¼å‡ºè¯¥åŒºåŸŸä½œä¸ºNIfTIæ ¼å¼çš„æ©ç æ–‡ä»¶ã€‚</li>
</ul>
<h3 id="3-è‡ªå®šä¹‰ç»˜åˆ¶æ©ç "><a class="markdownIt-Anchor" href="#3-è‡ªå®šä¹‰ç»˜åˆ¶æ©ç "></a> 3. è‡ªå®šä¹‰ç»˜åˆ¶æ©ç </h3>
<p>â€‹	å¦‚æœå…¬å¼€çš„å›¾è°±ä¸æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>MRIcron</code> ã€<code>ITK-SNAP</code> æˆ– <code>FSLeyes</code> ç­‰å·¥å…·æ‰‹åŠ¨ç»˜åˆ¶æ©ç ã€‚</p>
<ul>
<li>åœ¨è¿™äº›è½¯ä»¶ä¸­æ‰“å¼€ä¸€ä¸ªè„‘éƒ¨MRIå›¾åƒä½œä¸ºèƒŒæ™¯ã€‚</li>
<li>æ‰‹åŠ¨åœ¨ä½ æ„Ÿå…´è¶£çš„è§†è§‰åŒºåŸŸä¸Šç»˜åˆ¶ã€‚</li>
<li>ä¿å­˜ä½ ç»˜åˆ¶çš„åŒºåŸŸä¸ºæ©ç æ–‡ä»¶ã€‚</li>
</ul>
<h3 id="4-æå–è§†è§‰åŒºåŸŸçš„æ•°æ®"><a class="markdownIt-Anchor" href="#4-æå–è§†è§‰åŒºåŸŸçš„æ•°æ®"></a> 4. æå–è§†è§‰åŒºåŸŸçš„æ•°æ®</h3>
<p>â€‹	ä¸€æ—¦è·å¾—äº†è§†è§‰åŒºåŸŸçš„æ©ç æ–‡ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨Pythonï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨<code>nibabel</code>åº“ï¼‰æ¥è¯»å–fMRIæ•°æ®å’Œæ©ç æ–‡ä»¶ï¼Œç„¶åæå–è§†è§‰åŒºåŸŸçš„æ•°æ®äº†ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nibabel <span class="keyword">as</span> nib</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½fMRIæ•°æ®å’Œè§†è§‰åŒºæ©ç </span></span><br><span class="line">fmri_img = nib.load(<span class="string">'fmri_data.nii.gz'</span>)</span><br><span class="line">mask_img = nib.load(<span class="string">'visual_mask.nii.gz'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ•°æ®</span></span><br><span class="line">fmri_data = fmri_img.get_fdata()</span><br><span class="line">mask_data = mask_img.get_fdata()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ©ç åº”ç”¨åˆ°fMRIæ•°æ®</span></span><br><span class="line">visual_region_data = fmri_data[mask_data &gt; <span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<h1 id="4-è§†è§‰è§£ç æ¨¡å‹"><a class="markdownIt-Anchor" href="#4-è§†è§‰è§£ç æ¨¡å‹"></a> 4. è§†è§‰è§£ç æ¨¡å‹</h1>
<p>â€‹	åŸºäº fMRI çš„è§†è§‰ä¿¡æ¯è§£ç æ¨¡å‹èƒ½å¤Ÿæ ¹æ®è§†è§‰çš®å±‚ fMRI ä½“ç´ å“åº”é¢„æµ‹ç›¸åº”è‡ªç„¶å›¾åƒåˆºæ¿€çš„å†…å®¹ï¼Œå¦‚å›¾åƒåœºæ™¯è¯­ä¹‰ç±»åˆ«ã€åœºæ™¯å†…å®¹ç­‰ï¼Œé€šå¸¸æ ¹æ®è§£æä¿¡æ¯ç¨‹åº¦çš„ä¸åŒï¼ŒæŠŠè§†è§‰è§£ç ç»†åˆ†ä¸ºè§†è§‰åˆ†ç±»å’Œè§†è§‰é‡æ„ã€‚</p>
<h2 id="41-è§†è§‰åˆ†ç±»æ¨¡å‹"><a class="markdownIt-Anchor" href="#41-è§†è§‰åˆ†ç±»æ¨¡å‹"></a> 4.1 è§†è§‰åˆ†ç±»æ¨¡å‹</h2>
<h2 id="411ç®€ä»‹"><a class="markdownIt-Anchor" href="#411ç®€ä»‹"></a> 4.11ç®€ä»‹</h2>
<p>â€‹	è§†è§‰åˆ†ç±»æ¨¡å‹é¦–å…ˆåœ¨ fMRI æ•°æ®è®­ç»ƒé›†ä¸Šè®­ç»ƒè§†è§‰çš®å±‚ fMRI ä½“ç´ å“åº”åˆ°å›¾åƒåœºæ™¯è¯­ä¹‰ç±»åˆ«çš„æ˜ å°„ï¼Œç„¶åï¼Œèƒ½å¤Ÿæ ¹æ®æµ‹è¯•é›†ä¸­æ–°çš„è§†è§‰çš®å±‚ fMRI ä½“ç´ å“åº”é¢„æµ‹è¢«è¯•æ‰€è§‚çœ‹å›¾åƒåˆºæ¿€çš„åœºæ™¯è¯­ä¹‰ç±»åˆ«ã€‚ <strong>é€šå¸¸è§†è§‰çš®å±‚ä¸­ä½“ç´ æ•°é‡è¾ƒå¤šï¼Œå³è§†è§‰çš®å±‚åŒºåŸŸ fMRI ä½“ç´ å“åº”å‘é‡ç»´åº¦è¾ƒé«˜ï¼Œä¸” fMRI æ•°æ®é›†è§„æ¨¡è¾ƒå°ï¼Œç›´æ¥è¿›è¡Œæ¨¡å‹è®­ç»ƒå®¹æ˜“å¯¼è‡´è¿‡æ‹Ÿåˆã€‚</strong> å› æ­¤ï¼Œåœ¨è§†è§‰çš®å±‚å¤§é‡ä½“ç´ å“åº”è¾“å…¥æ¨¡å‹ä¹‹å‰ï¼Œé€šå¸¸ä»è§†è§‰åŒºåŸŸä¸­çš„å¤§é‡ä½“ç´ ä¸­ <strong>æŒ‘é€‰ä¸€äº›é‡è¦çš„ä½“ç´ ï¼Œé™ä½ç”¨äºåç»­è§†è§‰åˆ†ç±»æ¨¡å‹æ„å»ºçš„è¾“å…¥ç»´åº¦</strong> ï¼Œä»è€Œæé«˜åˆ†ç±»æ¨¡å‹çš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚</p>
<blockquote>
<p>æ ·æœ¬å°‘ï¼Œç‰¹å¾é«˜ç»´ï¼Œææ˜“è¿‡æ‹ŸåˆåŸå› ï¼šç”±äºç‰¹å¾æ•°é‡ä¼—å¤šï¼Œæ¨¡å‹æœ‰èƒ½åŠ›å­¦ä¹ è®­ç»ƒæ•°æ®ä¸­çš„å¤æ‚æ¨¡å¼ã€‚ç„¶è€Œï¼Œç”±äºæ ·æœ¬å¦‚æ­¤ä¹‹å°‘ï¼Œå…¶ä¸­è®¸å¤šæ¨¡å¼å¾ˆå¯èƒ½æ˜¯å™ªå£°è€Œä¸æ˜¯ä¸è®¤çŸ¥çŠ¶æ€ç›¸å…³çš„çœŸå®ä¿¡å·ã€‚æ¨¡å‹å¯èƒ½æœ€ç»ˆä¼šè®°ä½è¿™äº›å™ªå£°æ¨¡å¼ï¼Œè¿™äº›æ¨¡å¼æ— æ³•å¾ˆå¥½åœ°æ¨å¹¿åˆ°æ–°çš„ã€æœªè§è¿‡çš„æ•°æ®ã€‚</p>
</blockquote>
<h2 id="412-ä¸»è¦é™ç»´æ–¹æ³•"><a class="markdownIt-Anchor" href="#412-ä¸»è¦é™ç»´æ–¹æ³•"></a> 4.1.2 ä¸»è¦é™ç»´æ–¹æ³•</h2>
<ul>
<li>
<p>åŸºäºæ„Ÿå…´è¶£åŒºåŸŸ</p>
<blockquote>
<p>åŸºäºæ„Ÿå…´è¶£åŒºåŸŸçš„ä½“ç´ é™ç»´æ–¹æ³•æ ¹æ®è§†è§‰çš®å±‚çš„è§£å‰–å­¦å®šä½æˆ–è€…åŠŸèƒ½å®šä½ï¼Œé€‰å–æŸäº›æ„Ÿå…´è¶£åŒºåŸŸå†…çš„ä½“ç´ ï¼Œè¾“å…¥è§†è§‰åˆ†ç±»æ¨¡å‹ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§é™ä½è¾“å…¥çš„ä½“ç´ è§„æ¨¡ã€‚é€šå¸¸é€‰å–å¤§è„‘è§†è§‰çš®å±‚ä¸­ä¸å›¾åƒè¯†åˆ«ç­‰ç›¸å…³çš„åŒºåŸŸä½œä¸º ROIã€‚å¦å¤–ï¼Œç”±äºç»å¤§å¤šæ•°çš„ fMRI ä¿¡å·éƒ½æ˜¯å­˜åœ¨äºç°è´¨ä¸Šï¼Œé€šå¸¸åªä¿ç•™ç°è´¨ä¸Šçš„ä½“ç´ ã€‚</p>
</blockquote>
</li>
<li>
<p>åŸºäºä¸»æˆåˆ†åˆ†ææ³•</p>
<blockquote>
<p>ä¸åŒä¸ä½“ç´ é€‰æ‹©çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ©ç”¨ä¸»æˆåˆ†åˆ†æ(Principal Component Analysis, PCA)å¯¹ä½“ç´ é™ç»´ã€‚é€šè¿‡çº¿æ€§å˜åŒ–æŠŠä½“ç´ æ˜ å°„åˆ°å¦å¤–ä¸€ä¸ªä½ç»´ç©ºé—´ï¼Œé€šè¿‡æ„é€ è¿™ä¸ªä½ç»´ç©ºé—´ï¼Œä½¿å¾—ä½“ç´ æŠ•å½±åˆ°æ–°çš„ä½ç»´ç©ºé—´ï¼Œä¸”èƒ½å¤Ÿä¿æŒåŸæœ‰è¾ƒå¤šçš„ä¿¡æ¯ï¼Œé€šè¿‡é€‰æ‹©ä½ç»´ç©ºé—´ä¸­æŠ•å½±æ•°é‡å€¼è¾ƒå¤§çš„å‰å‡ ä¸ªç»´åº¦ï¼Œä¿æŒåŸå§‹ä½“ç´ å¯¹æ–¹å·®è´¡çŒ®æœ€å¤§çš„ç‰¹å¾å®ç°äº†å¯¹ä½“ç´ çš„é™ç»´ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader, TensorDataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡è®¾æ•°æ®å·²åŠ è½½å’Œé¢„å¤„ç†</span></span><br><span class="line"><span class="comment"># dataçš„å½¢çŠ¶ä¸º[N, D, H, W, T]ï¼Œå…¶ä¸­Næ˜¯æ ·æœ¬æ•°ï¼ŒDæ˜¯æ·±åº¦ï¼ŒHæ˜¯é«˜åº¦ï¼ŒWæ˜¯å®½åº¦ï¼ŒTæ˜¯æ—¶é—´ç‚¹æ•°</span></span><br><span class="line"><span class="comment"># labelsæ˜¯ç›¸åº”çš„æ ‡ç­¾ï¼Œå½¢çŠ¶ä¸º[N]</span></span><br><span class="line"><span class="comment"># ä¸ºäº†ç®€åŒ–ï¼Œè¿™é‡Œåªè€ƒè™‘ä¸€ä¸ªæ—¶é—´ç‚¹çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨data[:, :, :, :, 0]æˆ–è€…ä»»ä½•ä¸€ä¸ªæ—¶é—´ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3D CNNæ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Simple3DCNN</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(Simple3DCNN, self).__init__()</span><br><span class="line">        self.conv1 = nn.Conv3d(<span class="number">1</span>, <span class="number">32</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>)  <span class="comment"># è¾“å…¥é€šé“ä¸º1ï¼Œè¾“å‡ºé€šé“ä¸º32</span></span><br><span class="line">        self.pool = nn.MaxPool3d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>, padding=<span class="number">0</span>)</span><br><span class="line">        self.conv2 = nn.Conv3d(<span class="number">32</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.fc1 = nn.Linear(<span class="number">64</span> * <span class="number">26</span> * <span class="number">26</span> * <span class="number">34</span>, <span class="number">128</span>)  <span class="comment"># å‡è®¾ç»è¿‡ä¸¤æ¬¡æ± åŒ–åçš„ç»´åº¦</span></span><br><span class="line">        self.fc2 = nn.Linear(<span class="number">128</span>, <span class="number">2</span>)  <span class="comment"># å‡è®¾æ˜¯ä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = self.pool(F.relu(self.conv1(x)))</span><br><span class="line">        x = self.pool(F.relu(self.conv2(x)))</span><br><span class="line">        x = x.view(-<span class="number">1</span>, <span class="number">64</span> * <span class="number">26</span> * <span class="number">26</span> * <span class="number">34</span>)  <span class="comment"># Flattenæ“ä½œ</span></span><br><span class="line">        x = F.relu(self.fc1(x))</span><br><span class="line">        x = self.fc2(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®å‡†å¤‡</span></span><br><span class="line"><span class="comment"># å‡è®¾ä½ å·²æœ‰çš„dataå’Œlabels</span></span><br><span class="line"><span class="comment"># data = ...  # é¢„å¤„ç†åçš„fMRIæ•°æ®ï¼Œå½¢çŠ¶[N, 1, D, H, W]</span></span><br><span class="line"><span class="comment"># labels = ...  # æ ‡ç­¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸ºtorch tensors</span></span><br><span class="line">data_tensor = torch.Tensor(data)  <span class="comment"># éœ€è¦å°†æ•°æ®è½¬æ¢ä¸ºtorchå¼ é‡</span></span><br><span class="line">labels_tensor = torch.Tensor(labels).long()  <span class="comment"># æ ‡ç­¾ä¹Ÿéœ€è¦è½¬æ¢ä¸ºtorchå¼ é‡ï¼Œä½¿ç”¨.long()è½¬æ¢ä¸ºæ•´æ•°ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®åŠ è½½å™¨</span></span><br><span class="line">dataset = TensorDataset(data_tensor, labels_tensor)</span><br><span class="line">dataloader = DataLoader(dataset, batch_size=<span class="number">4</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ¨¡å‹ã€æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span></span><br><span class="line">model = Simple3DCNN()</span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = optim.Adam(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">num_epochs = <span class="number">10</span>  <span class="comment"># è®­ç»ƒå‘¨æœŸæ•°</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> i, (inputs, labels) <span class="keyword">in</span> <span class="built_in">enumerate</span>(dataloader):</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        outputs = model(inputs)</span><br><span class="line">        loss = criterion(outputs, labels)</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Epoch [<span class="subst">{epoch+<span class="number">1</span>}</span>/<span class="subst">{num_epochs}</span>], Loss: <span class="subst">{loss.item()}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p><strong>å‚è€ƒé“¾æ¥ï¼š</strong></p>
<p>[2] <a target="_blank" rel="noopener" href="https://blog.csdn.net/Joker00007/article/details/127754815">DICOM è¯¦è§£</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://www.tasq.ai/glossary/nifti/">NifTi ä»‹ç»</a></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>CY</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://example.com/2024/03/21/fmri/">http://example.com/2024/03/21/fmri/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/data-process/"># data process</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
            <a class="next" rel="next" href="/2023/12/01/leetcode/">leetcode</a>
            
        </section>


    </article>
</div>



    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
      var gitalk = new Gitalk({
        clientID: '9810f94b2996825e7931',
        clientSecret: 'c1aee8c436730130e3ad18694d20888a1ee13bce',
        repo: 'Seperendity.github.io',
        owner: 'Seperendity',
        admin: 'Seperendity',
        id: location.pathname,
        labels: 'Gitalk'.split(',').filter(l => l),
        perPage: 10,
        pagerDirection: 'last',
        createIssueManually: true,
        distractionFreeMode: false
      })
      gitalk.render('gitalk-container')
</script>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© CY | 2022 - 2024 ğŸ˜‰ Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a>
		|
		<!-- è®¿å®¢æ•°é‡ -->
		
		  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<span class="site-uv">

  <i class="iconfont icon-yonghu "></i>

 <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>

</span>&nbsp;





<span class="site-pv">

 <i class="iconfont icon-jiaoyinzujifangke "></i>

 <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>

</span>


		
		</span>
    </div>
</footer>

<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);  // 50mså‘¨æœŸæ£€æµ‹å‡½æ•°
        var pvcountOffset = 80000;  // åˆå§‹åŒ–é¦–æ¬¡æ•°æ®
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // åŠ ä¸Šåˆå§‹æ•°æ® 
                clearInterval(int); // åœæ­¢æ£€æµ‹
            }
        }
    });
</script>

    </div>
	
	<!-- æœç´¢åŠŸèƒ½ -->
	<!-- Chic/layout.ejs -->
	<div id="u-search">
		<div class="modal">
			<div class="modal-header">
				<div class="container">
					<form id="u-search-modal-form" class="u-search-modal-form">
						<button type="submit" class="form-submit-btn">
							<img src="/image/search.png" class="search-btn-img" />
						</button>
						<input placeholder="æœç´¢å†…å®¹..." class="form-input" id="modal-form-input">
					</form>
					<a class="modal-close">x</a>
				</div>
				<div class="search-loading">
					<div class="search-loading-bar"></div>
				</div>
			</div>
			<div class="modal-body">
			</div>
		</div>
		<div class="modal-overlay"></div>
	</div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
<script>
!
function() {
    function n(n, e, t) {
        return n.getAttribute(e) || t
    }
    function e(n) {
        return document.getElementsByTagName(n)
    }
    function t() {
        var t = e("script"),
        o = t.length,
        i = t[o - 1];
        return {
            l: o,
            z: n(i, "zIndex", -1),     //ç½®äºä¸»é¡µé¢èƒŒå
            o: n(i, "opacity", .5),     //çº¿æ¡é€æ˜åº¦
            c: n(i, "color", "0,0,0"),  //çº¿æ¡é¢œè‰²
            n: n(i, "count", 100)    //çº¿æ¡æ•°é‡
        }
    }
    function o() {
        a = m.width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,
        c = m.height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight
    }
    function i() {
        r.clearRect(0, 0, a, c);
        var n, e, t, o, m, l;
        s.forEach(function(i, x) {
            for (i.x += i.xa, i.y += i.ya, i.xa *= i.x > a || i.x < 0 ? -1 : 1, i.ya *= i.y > c || i.y < 0 ? -1 : 1, r.fillRect(i.x - .5, i.y - .5, 1, 1), e = x + 1; e < u.length; e++) n = u[e],
            null !== n.x && null !== n.y && (o = i.x - n.x, m = i.y - n.y, l = o * o + m * m, l < n.max && (n === y && l >= n.max / 2 && (i.x -= .03 * o, i.y -= .03 * m), t = (n.max - l) / n.max, r.beginPath(), r.lineWidth = t / 2, r.strokeStyle = "rgba(" + d.c + "," + (t + .2) + ")", r.moveTo(i.x, i.y), r.lineTo(n.x, n.y), r.stroke()))
        }),
        x(i)
    }
    var a, c, u, m = document.createElement("canvas"),
    d = t(),
    l = "c_n" + d.l,
    r = m.getContext("2d"),
    x = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
    function(n) {
        window.setTimeout(n, 1e3 / 45)
    },
    w = Math.random,
    y = {
        x: null,
        y: null,
        max: 2e4
    };
    m.id = l,
    m.style.cssText = "position:fixed;top:0;left:0;z-index:" + d.z + ";opacity:" + d.o,
    e("body")[0].appendChild(m),
    o(),
    window.onresize = o,
    window.onmousemove = function(n) {
        n = n || window.event,
        y.x = n.clientX,
        y.y = n.clientY
    },
    window.onmouseout = function() {
        y.x = null,
        y.y = null
    };
    for (var s = [], f = 0; d.n > f; f++) {
        var h = w() * a,
        g = w() * c,
        v = 2 * w() - 1,
        p = 2 * w() - 1;
        s.push({
            x: h,
            y: g,
            xa: v,
            ya: p,
            max: 6e3
        })
    }
    u = s.concat([y]),
    setTimeout(function() {
        i()
    },
    100)
} ();
</script>

<script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=350&t=m&d=1NqKKNlM62oDkLYA7mQMmVg49mUH_Ib-6MkRgvd04o8&co=2d78ad&cmo=ffc253&cmn=ff5353&ct=ffffff'></script>

</html>